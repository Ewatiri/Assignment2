<html>
  <style type = "text/css">
    #inds{
	margin-left: 400px;
	margin-top: -100px;
	}
  </style>
  <script type = "text/javascript">
    charts = {};
	maps = new Object();
	reports = new Object();
	var d = 0,cTotal = 0,mTotal= 0,rTotal = 0;
	 
	 function getTotals(){
	   $.get('../api/reportTables.json',function(i, data){
	   });
	 }
    $(document).ready(function (){
	  $("#search").keyup(function(){
	    $("indGrp").html("");
		$("inds").html("");
	    $.get('../api/indicatorGroups/query/'+$(this).val()+'.json',function(json){
		  $(json.indicatorGroups).each(function(i,data){
		    var indGrp = $("<a></a>").attr("href",data.href).append(data.name);
			$("#indGrp").append(indGrp).append("</br>");
			indGrp.bind('click',function(evt){
			  evt.preventDefault();
			  $.get($(this).attr("href")+".json",function(json2){
			    //console.log($(this));
			    $(json2.indicators).each(function (i, datum){
				  var indics = $("<a></a>").attr("href","#").append(datum.name);
				  $("#inds").append(indics).append("</br>");
				  var id = datum.id;
				   (getChartData(datum.id));
			///	   	console.dir(charts);
					indics.bind("click", function(evt2){
					  evt2.preventDefault();
					  getIndiv(datum.id);
					  
					});
			
				});
			  });
			  			  
			});
		  });
		});
	  });
	  
	});
   $(document).ajaxStop(function(){
    d = 0;
	for (key in charts){
	 d +=(charts[key]);
	 
	}
	console.log("Indicator grp usage:",+d/cTotal);
	//console.log("The total:"+total);
   });
	
	
	function getChartData(indId)
	{
	 charts = {};
	  var hit = 0, miss = 0;
	  charts[indId] = 0;
	  $.get('../api/charts.json',function(charty){
	    $(charty.charts).each(function (index, data){
		  $.get(data.href+'.json',function (specChart){
		    $(specChart).each(function(i,d){
			  $(d.indicators).each(function (i2,d2){
			    if (indId == d2.id)
				{
				  charts[indId] = ++hit;
				}
			  });
			  total = index;
			  //console.log(charty);
			});
			
		  });
		});
		cTotal = charty.pager.total;
	  });
	  
	}
	
    function getMapData(indId)
	{
	 maps = {};
	  var hit = 0, miss = 0;
	  charts[indId] = 0;
	  $.get('../api/mapViews.json',function(mappy){
	    $(mappy.mapViews).each(function (index, data){
		  $.get(data.href+'.json',function (specMap){
		    $(specMap).each(function(i,d){
			  $(d.indicators).each(function (i2,d2){
			    if (indId == d2.id)
				{
				  maps[indId] = ++hit;
				}
			  });
		
			  //console.log(charty);
			});
			
		  });
		});
		
	  });
	  
	}
	
	function getReportData(indId)
	{
	 reports = {};
	  var hit = 0, miss = 0;
	  reports[indId] = 0;
	  $.get('../api/reportTables.json',function(reppy){
	    $(reppy.reportTables).each(function (index, data){
		  $.get(data.href+'.json',function (specRep){
		    $(specRep).each(function(i,d){
			  $(d.indicators).each(function (i2,d2){
			    if (indId == d2.id)
				{
				  reports[indId] = ++hit;
				}
			  });
		
			  //console.log(charty);
			});
			
		  });
		});
		
	  });
	  
	}
	
	function getIndiv(indId){
	$("#results").html("");
	$(document).ajaxStop(function(){
	    var indCharts = charts[indId]/cTotal * 100;
		var a1 = $("<p></p>").append(indCharts);
		$("#results").append(a1);
	  //var indMaps = maps[indId]/mTotal*100;
	  //var indRep = reports[indId]/rTotal * 100;
	   //console.log(indMaps);
	  //console.log(indReports);
	});
	
	}
	
	
	
	  
	
  </script>
  <div>
    <label for = "search">Search Indicators</label>
    <input type = "text" id = "search" />
    <div id = "indGrp">
	</div>
	<div id = "inds">
	 
	</div>
	<div id = "results">
	</div>
  </div>
</html>